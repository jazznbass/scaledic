---
title: "Building a dictionary file"
author: "JÃ¼rgen Wilbert"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Building a dictionary file}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
library(knitr)
library(dplyr)
library(tibble)
library(psych)
library(scaledic)
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## What is a dictionary file?

When you conduct research based on questionnaires or psychometric tests (and you are working in R), you typically create a *data.frame* with one column (variable) for each item on that questionnaire and one row for each person who participated. You can only store a limited amount of additional information about each item in that questionnaire within a data.frame (or tibble). You can give a variable a name and define a variable as a factor with appropriate levels. But basically, that is it. You cannot, at least not conveniently, include a longer label for each item, the name of a scale this item belongs to, information about reverse coding, etc.

I call the collection of this additional information about items an *item dictionary*. A dictionary contains a short label, a longer description, scale affiliation, and more for each item. It is a table with one row per item and one column for any additional information about those items.   
In the following examples I will lay out the construction of a dictionary file.

First, we need an example data.frame to work with:

```{r echo = FALSE}
set.seed(21)
n <- 20
n_scale <- 5
scales <- c("rel", "sui")
n_var <- n_scale * length(scales)
dat <- cbind(
  matrix(sample(1:6, n_scale * n, replace = TRUE), ncol = n_scale),
  matrix(sample(0:4, n_scale * n, replace = TRUE), ncol = n_scale)
)
dat <- as.data.frame(dat)
names(dat) <- paste(rep(scales, each = n_scale), rep(1:n_scale, length(scales)), sep = "_")
dat$gender <- sample(c("m", "f", "d"), n, replace = TRUE)
dat$age <- sample(6:10, n, replace = TRUE)
```

```{r echo=FALSE}
dat %>% slice(1:10) %>% kable(caption = "First ten rows of the data frame")#rmarkdown::paged_table()
```

```{r echo=FALSE}
item_names <- c("How often do you attend church or other religious meetings?",
"How often do you spend time in private religious activities, such as prayer, meditation or Bible study?", "In my life, I experience the presence of the Divine (i.e., God)", "My religious beliefs are what really lie behind my whole approach to life", "I try hard to carry my religion over into all other dealings in life",
paste("Did you feel", c("tense", "blue", "irritated", "inferior"), "in the last week?"), "Did you have problems falling asleep in the last week?")

value_labels <- c("1 = Never; 2 = Once a year or less; 3 = A few times a year; 4 = A few times a month; 5 = Once a week; 6 = More than once/week", "1 = Rarely or never; 2 = A few times a month; 3 = Once a week; 4 = Two or more times/week; 5 = Daily; 6 = More than once a day", rep("1 = Definitely not true; 2 = Tends not to be true; 3 = Unsure; 4 = Tends to be true; 5 = Definitely true of me", 3),
  rep(c("0 = not at all; 1; 2; 3; 4 = extremely"), 5)
)

dic <- data.frame(
  item_name = names(dat),
  item_label = c(item_names, "gender", "age"),
  scale = c(rep(c("rel", "sui"), each = 5), rep("misc",2)),
  scale_label = c(rep(c("Religious beliefs", "Suicide tendency"), each = 5), rep("Miscellaneous",2)),
  values = c(rep("1:6", 5), rep("0:4", 5), "'m', 'f', 'ka'", "5:11"),
  value_labels = c(value_labels, "m = male; f = female; d = diverse", ""),
  type = c(rep("integer", n_var), "factor", "integer"),
  weight = 1,
  missing = c(rep("-999", n_var), "", "-999")
)

```

The easiest way to create a dictionary file is to use a spreadsheet program and to import the file.  

We start the example with a very simple dictionary file which only contains the item labels and the corresponding items names (i.e, the corresponding variable names in our data frame):


```{r echo=FALSE}
dic %>% select(1:2) %>% kable(caption = "Dictionary file")#rmarkdown::paged_table()
```
```{r include = FALSE}
dic_file <- dic[,1:2]
```



```{r}
dat_dic <- apply_dic(dat, dic_file)
dat_dic <- check_values(dat_dic, report = TRUE)
replace_missing(dat_dic)
```

```{r include = FALSE}
dic_file <- dic[,1:2]
```

```{r}
dat_dic <- apply_dic(dat, dic_file)
```

##

```{r echo=FALSE}
dic_file <- dic %>% select(1,2,"weight", "type")
dic_file %>% kable(caption = "Dictionary file")#rmarkdown::paged_table()
```

```{r}
dat_dic <- apply_dic(dat, dic_file)
```

##

```{r echo=FALSE}
dic_file <- dic %>% select(1,2, "values", "value_labels", "weight", "type")
dic_file %>% kable(caption = "Dictionary file")#rmarkdown::paged_table()
```

```{r}
dat_dic <- apply_dic(dat, dic_file)
```

